import{jsxs as g,jsx as i}from"react/jsx-runtime";import{useQuery as k}from"@tanstack/react-query";import{useNavigate as $}from"@tanstack/react-router";import{useMemo as j}from"react";import{ChevronLeft as R,ChevronRight as T,Calendar as A}from"lucide-react";import{B as C,c as S,g as L,R as E,h as z,i as P,j as F}from"./ssr-BorI3jCH.js";import{L as B}from"./layout-DeG64cWT.js";import"@tanstack/react-router-with-query";import"sonner";import"zod";import"zod-validation-error";import"@radix-ui/react-icons";import"better-auth/react";import"@tanstack/router-core";import"node:async_hooks";import"h3";import"@radix-ui/react-slot";import"class-variance-authority";import"clsx";import"tailwind-merge";import"@radix-ui/react-navigation-menu";import"@radix-ui/react-avatar";import"@radix-ui/react-dropdown-menu";import"@radix-ui/react-switch";import"date-fns";import"node:stream";import"react-dom/server";import"node:stream/web";const Q=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Y=p=>`${p.getFullYear()}-${(p.getMonth()+1).toString().padStart(2,"0")}-${p.getDate().toString().padStart(2,"0")}`,W=({events:p,onCurrentDateChange:y,currentDate:m})=>{const f=()=>{const n=m.getFullYear(),e=m.getMonth(),r=new Date(n,e,1).getDay(),h=new Date(n,e+1,0).getDate(),d=[];let o=[];if(r>0){const t=e===0?11:e-1,a=e===0?n-1:n,l=new Date(a,t+1,0).getDate();for(let s=0;s<r;s++)o.push({date:new Date(a,t,l-r+1+s),isCurrentMonth:!1})}for(let t=1;t<=h;t++)o.push({date:new Date(n,e,t),isCurrentMonth:!0}),o.length===7&&(d.push(o),o=[]);if(o.length>0){const t=e===11?0:e+1,a=e===11?n+1:n;let l=1;for(;o.length<7;)o.push({date:new Date(a,t,l++),isCurrentMonth:!1});d.push(o)}return d},D=n=>{const e=Y(n);return p.filter(r=>e>=r.date&&e<=r.dateEnd).sort((r,h)=>r.date.localeCompare(h.date))},x=n=>{const e=[];n.forEach((t,a)=>{D(t.date).forEach(s=>{const w=`${s.date}-${s.dateEnd}-${s.name}`,u=e.find(N=>N.key===w);u?(u.start=Math.min(u.start,a),u.end=Math.max(u.end,a)):e.push({event:s,start:a,end:a,key:w})})}),e.sort((t,a)=>t.start-a.start);const r=[],h=e.map(t=>{let a=-1;for(let l=0;l<r.length;l++)if(t.start>r[l].end){a=l,r[l].end=t.end;break}return a===-1&&(a=r.length,r.push({end:t.end})),{...t,slot:a}}),d=r.length,o=Array(n.length).fill(null).map(()=>Array(d).fill(null));return h.forEach(t=>{for(let a=t.start;a<=t.end;a++)o[a][t.slot]=t.event}),{weekCells:o,numSlots:d}},b=()=>{y(new Date(m.getFullYear(),m.getMonth()-1,1))},M=()=>{y(new Date(m.getFullYear(),m.getMonth()+1,1))},v=n=>{const e=new Date;return n.getDate()===e.getDate()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()},c=()=>{y(new Date(new Date().setDate(1)))};return g("div",{className:"bg-white rounded-lg shadow-md p-4 border border-gray-200",children:[g("div",{className:"flex justify-between items-center mb-6",children:[g("div",{className:"flex items-center space-x-1",children:[i(C,{onClick:b,variant:"outline",size:"icon",className:"h-8 w-8",children:i(R,{className:"h-4 w-4"})}),i(C,{onClick:M,variant:"outline",size:"icon",className:"h-8 w-8",children:i(T,{className:"h-4 w-4"})})]}),i("h2",{className:"text-xl font-bold",children:m.toLocaleString("default",{month:"long",year:"numeric"})}),g(C,{onClick:c,variant:"outline",size:"sm",className:"flex items-center gap-1",children:[i(A,{className:"h-4 w-4 mr-1"}),"Today"]})]}),g("div",{className:"grid grid-cols-7 gap-1",children:[Q.map(n=>i("div",{className:"text-center font-medium text-gray-500 text-sm py-2",children:n},n)),f().map((n,e)=>{const{weekCells:r,numSlots:h}=x(n);return n.map((d,o)=>{const t=v(d.date);return g("div",{className:S("border rounded min-h-[6rem] flex flex-col p-1 relative transition-colors",d.isCurrentMonth?"bg-white":"bg-gray-50 text-gray-400",t&&"ring-2 ring-primary ring-offset-1","hover:bg-gray-50"),children:[i("span",{className:S("text-sm font-medium h-6 w-6 flex items-center justify-center rounded-full",t&&"bg-primary text-primary-foreground"),children:d.date.getDate()}),i("div",{className:"flex flex-col gap-1 mt-1 w-full",children:Array.from({length:h}).map((a,l)=>{const s=r[o][l];if(s){const w=Y(d.date),u=w===s.date,N=w===s.dateEnd;return i("div",{className:S("w-full h-5 relative overflow-hidden",L(s.name),u?"rounded-l-md":"",N?"rounded-r-md":"","shadow-sm hover:opacity-90 cursor-pointer"),title:s.name,children:i("span",{className:"absolute inset-0 flex items-center justify-start text-white text-xs px-1 truncate",children:s.name})},l)}return i("div",{className:"w-full h-5"},l)})})]},`${e}-${o}`)})})]})]})},gt=function(){const y=$(),{date:m}=E.useSearch(),f=new Date(m||Date.now()),D=v=>{y({from:E.fullPath,search:{date:F(v)}})},{firstSunday:x,lastSaturday:b}=j(()=>z(f.getFullYear(),f.getMonth()+1),[f]),{data:M}=k({...P.list({startDate:F(x)}),select:v=>v.filter(c=>c.date).map(c=>({...c,date:c.date,dateEnd:c.dateEnd??c.date}))});return i(B,{children:i(W,{events:M??[],currentDate:f,onCurrentDateChange:D})})};export{gt as component};
